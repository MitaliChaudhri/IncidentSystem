sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Dialog"],function(e,t,o,n,s,i){"use strict";return e.extend("cosincidentportalhs.controller.IncidentPortalHS",{onInit:function(){const e=new n({Notes:{addedby:"",addedon:"",IncNotes:"",NotesType:-1,NotesReview:-1,INCI_ID:"",INCI_INCID:""},Payload:{InvestigationBy:"",DateInvest:"",EmpRTW:-1,InvStatDetails:"",InvstStatus:"",INCI_ID:"",INCI_INCID:""},CorrectAction:{AssignTo:"",DueDate:"",CAStatus:"",Comments:""},FollowUp:{followcrdate:"",followupcrby:"",folloupduedate:"",followupstat:"",followupcrfor:"",followupnotes:"",compdate:"",followupflg:""},Payload2:{ReqAccom:-1,isaccomgttendays:-1,reasonforref:-1,Other:"",IssueHistory:"",INCI_ID:"",INCI_INCID:""},Payload3:{stdate:"",Antienddate:"",Union:"",AccoPosDept:"",date:"",INCI_ID:"",INCI_INCID:""},Payload4:{WCB:{},inj:[{primaryinj:"",bodypart:"",side:""}]},IncidentCategorys:[{CatId:"1",Cattext:"Injury/Illness"},{CatId:"2",Cattext:"Property /Equipment Damage"},{CatId:"3",Cattext:"Near Miss"},{CatId:"4",Cattext:"Dangerous Occurrence"},{CatId:"5",Cattext:"Environment"},{CatId:"6",Cattext:"Security"}],IncidentTypes:[{TypeId:"1",IncText:"Non-Occupational"},{TypeId:"2",IncText:"No Treatment"},{TypeId:"3",IncText:"First Aid"},{TypeId:"4",IncText:"Medical Consultation"},{TypeId:"5",IncText:"Medical Aid"},{TypeId:"6",IncText:"Modified Work"},{TypeId:"7",IncText:"Lost time Incident"},{TypeId:"8",IncText:"Psychological"},{TypeId:"9",IncText:"Fatality"}],TypeofEvents:[{eventId:"1",eventtext:"Corporate"},{eventId:"2",eventtext:"Private"},{eventId:"3",eventtext:"Charity"}],IncSevirity:[{SevId:"1",Sevtext:"Critical"},{SevId:"2",Sevtext:"Major"},{SevId:"3",Sevtext:"Minor"}],WCBInjuryCategory:[{InjCatID:"1",InjCatText:"Acute Injury"},{InjCatID:"2",InjCatText:"Chronic Injury"}],WCBInjurySubCategory:[{InjSubCatID:"1",InjSubCatText:"Fractures"},{InjSubCatID:"2",InjSubCatText:"Sprains"},{InjSubCatID:"3",InjSubCatText:"Spinal Cord Injury"},{InjSubCatID:"4",InjSubCatText:"Dislocation"}],WCBInjuryStatus:[{InjStatID:"1",InjStatText:"Active"},{InjStatID:"2",InjStatText:"Healing"},{InjStatID:"3",InjStatText:"Recovered"},{InjStatID:"4",InjStatText:"Recurrent"}],WCBClaimStatus:[{ClaimStatID:"1",ClaimStatText:"Sbumitted"},{ClaimStatID:"2",ClaimStatText:"Under Review"},{ClaimStatID:"3",ClaimStatText:"Pending"},{ClaimStatID:"4",ClaimStatText:"Rejected"}],InjureSide:[{InjureSideID:"1",InjureSideText:"Upper"},{InjureSideID:"2",InjureSideText:"Lower"},{InjureSideID:"3",InjureSideText:"Right"},{InjureSideID:"4",InjureSideText:"Left"}],InjuryType:[{InjuryTypeID:"1",InjuryTypeText:"Primary"},{InjuryTypeID:"2",InjuryTypeText:"Secondary"}],EmpSupNames:[{name:"Stephan Lie",id:"1001"},{name:"Fay Van Damme",id:"1002"},{name:"Brevin Dice",id:"1003"},{name:"Regina Oleveria",id:"1004"},{name:"John Mathew",id:"1005"},{name:"Jim Parker",id:"1006"},{name:"Sophia Ran",id:"1007"},{name:"Wendi Blake",id:"1008"},{name:"Lois Lane",id:"1009"},{name:"Mary Magdalene",id:"1010"},{name:"Simon Cyrene",id:"1011"}],Payload1:{incident:{},wasIncOnCosloc:-1,noncosvehinvol:-1,isinvestreq:-1,shift:-1,wascosvehused:-1,isdraft:false,maxDate:new Date,COSEmployee:{},COSEquipment:[{EquipNo:""}],witness:[],addwellness:1,isCOSEmp:-1,COSEmployee:[],Contractor:[],Member:[],child1:false,child2:false,child3:false},ButtonVisibility:"1",child5:false,child6:false,child7:false,isSeparatorVisible:true});this.getView().setModel(e,"localModel");const t=new n(e.getData());this.getView().setModel(t,"oMasterData");var o=sap.ui.core.UIComponent.getRouterFor(this);o.getRoute("RouteIncidentPortalHS").attachMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=e.getParameters().arguments;var o=this.getOwnerComponent().getModel("globalModel"),n=t;o.setProperty("/keys",t);const s=t.ID;const i=t.INCID;var a=this.getOwnerComponent().getModel().getServiceUrl();var r=this.getView().byId("icontabbar1");r.setSelectedKey("icon1");const l=this.getView().getModel("localModel");const c=this.getView().getModel();const d=c.getServiceUrl();this.getView().byId("correctiveActionTable").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",s)]);this.getView().byId("NotesTable").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",s)]);this.getView().byId("FL1").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",s)]);$.ajax({url:a+"/Incident("+"ID="+n.ID+",INCID="+n.INCID+")",success:function(e){debugger}}),$.ajax({type:"GET",contentType:"application/json",url:d+"Incident"+"(ID="+s+",INCID="+i+")?$expand=CosEquip,Witn,cos_emp,contract,public",success:function(e){console.log("Success:",e);e.wascosvehused=parseInt(e.wascosvehused);e.wasIncOnCosloc=parseInt(e.wasIncOnCosloc);e.noncosvehinvol=parseInt(e.noncosvehinvol);e.isinvestreq=parseInt(e.isinvestreq);e.yearexppos=parseInt(e.yearexppos);e.shift=parseInt(e.shift);e.COSEmployee=e.cos_emp;e.COSEquipment=e.CosEquip;e.witness=e.Witn;e.Contractor=e.contract;e.Member=e.public;e.addwellness=parseInt(e.addmentalhealth);if(e.otherpeopinv!==undefined&&e.otherpeopinv!==null&&e.otherpeopinv!==""){e.child1=e.otherpeopinv.split(",")[0]==="1"?true:false;e.child2=e.otherpeopinv.split(",")[1]==="1"?true:false;e.child3=e.otherpeopinv.split(",")[2]==="1"?true:false}l.setProperty("/Payload1",e)}}),$.ajax({type:"GET",contentType:"application/json",url:d+"Investigation"+"?$filter=INCI_ID eq %27"+s+"%27",success:function(e){console.log("Success:",e);if(e.value.length>0){e.value[0].EmpRTW=parseInt(e.value[0].EmpRTW||-1);l.setProperty("/Payload",e.value[0]);c.refresh()}else{l.setProperty("/Payload",{})}},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:d+"EHSRef"+"?$filter=INCI_ID eq %27"+s+"%27",success:function(e){console.log("Success:",e);e.value[0].isaccomgttendays=parseInt(e.value[0].isaccomgttendays||-1);e.value[0].ReqAccom=parseInt(e.value[0].ReqAccom||-1);e.value[0].reasonforref=parseInt(e.value[0].reasonforref||-1);l.setProperty("/Payload2",e.value[0])},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:d+"RTW"+"?$filter=INCI_ID eq %27"+s+"%27",success:function(e){console.log("Success:",e);l.setProperty("/Payload3",e.value[0])},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:d+"WCB"+"?$filter=INCI_ID eq %27"+s+"%27&$expand=inj",success:function(e){if(e.value.length>0){e.value[0].Notimeloss=parseInt(e.value[0].Notimeloss||-1);l.setProperty("/Payload4",e.value[0]===undefined?{inj:[]}:e.value[0])}else{l.setProperty("/Payload4",{})}}});const g=l.getProperty("/Payload/EmpRTW");if(g!==-1){var p=g===0;var y=this.byId("rtwid");console.log(y);y.setVisible(p);if(p){const e=this.getView().getModel("localModel");e.setProperty("/isSeparatorVisible",true)}else{const e=this.getView().getModel("localModel");e.setProperty("/isSeparatorVisible",false)}}},onUpdateIncident:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=n.INCID;const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Payload1/IncNo");const d=a.getProperty("/Payload1/Title");const g=a.getProperty("/Payload1/empname");const p=a.getProperty("/Payload1/empid");const y=a.getProperty("/Payload1/emppos");const u=a.getProperty("/Payload1/division");const I=a.getProperty("/Payload1/dept");const P=a.getProperty("/Payload1/section");const f=a.getProperty("/Payload1/incDate");const h=a.getProperty("/Payload1/inctime");const C=a.getProperty("/Payload1/incDaterep");const m=a.getProperty("/Payload1/inctimerep");const D=a.getProperty("/Payload1/supid");const w=a.getProperty("/Payload1/supname");const M=a.getProperty("/Payload1/yearexppos");const S=a.getProperty("/Payload1/wasIncOnCosloc");const v=a.getProperty("/Payload1/shift");const N=a.getProperty("/Payload1/latitude");const j=a.getProperty("/Payload1/longitude");const T=a.getProperty("/Payload1/wascosvehused");const x=a.getProperty("/Payload1/addwellness");const b=a.getProperty("/Payload1/busno");const O=a.getProperty("/Payload1/noncosvehinvol");const V=a.getProperty("/Payload1/policereportno");const A=a.getProperty("/Payload1/incCategory");const E=a.getProperty("/Payload1/incType");const U=a.getProperty("/Payload1/eventtype");const _=a.getProperty("/Payload1/actincseverity");const B=a.getProperty("/Payload1/potseverity");const F=a.getProperty("/Payload1/isinvestreq");let R=a.getProperty("/Payload1/child1")===true?"1":"0";R+=",";R+=a.getProperty("/Payload1/child2")===true?"1":"0";R+=",";R+=a.getProperty("/Payload1/child3")===true?"1":"0";const q=a.getProperty("/Payload1/incdesc");const W=a.getProperty("/Payload1/isdraft");const k=a.getProperty("/Payload1/COSEquipment");const J=a.getProperty("/Payload1/witness");const H=a.getProperty("/Payload1/COSEmployee");const L=a.getProperty("/Payload1/Contractor");const G=a.getProperty("/Payload1/Member");const K=new Date;var z=new Date(K),Q=""+(z.getMonth()+1),Y=""+z.getDate(),X=z.getFullYear();if(Q.length<2)Q="0"+Q;if(Y.length<2)Y="0"+Y;const Z={INCID:a.getProperty("/Payload1/INCID"),IncNo:c,Title:d,empname:g,empid:p,emppos:y,division:u,dept:I,section:P,incDate:f,inctime:h,incDaterep:C,inctimerep:m,supid:D,supname:w,yearexppos:parseInt(M,10)||0,wasIncOnCosloc:S.toString(),shift:v.toString(),latitude:N,longitude:j,wascosvehused:T.toString(),addmentalhealth:x.toString(),busno:b,noncosvehinvol:O.toString(),policereportno:V,incCategory:A,incType:E,eventtype:U,actincseverity:_,potseverity:B,isinvestreq:F.toString(),otherpeopinv:R,incdesc:q,isdraft:"0",CosEquip:k.map(e=>{e.EquipNo=parseInt(e.EquipNo,10);return e}),Witn:J,cos_emp:H,contract:L,public:G};if(e.oSource.mProperties.text==="Submit"){Z.isdraft="0"}else{Z.isdraft="1"}Z.ID=a.getProperty("/Payload1/ID");$.ajax({type:"PUT",contentType:"application/json",url:l+"Incident(ID="+s+",INCID="+i+")",data:JSON.stringify(Z),success:function(e){t.success("Incident "+c+" Updated Successfully.")}})},onAddCOSEquip:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/COSEquipment");t.push({EquipNo:""});e.setProperty("/Payload1/COSEquipment",t)},onDeleteCOS:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/COSEquipment");if(n.length>1){n.splice(t,1)}o.setProperty("/Payload1/COSEquipment",n)},onAddWitness:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/witness");t.push({});e.setProperty("/Payload1/witness",t)},onDelete:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/witness");n.splice(t,1);o.setProperty("/Payload1/witness",n)},onAddCOSEmployee:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/COSEmployee");t.push({});e.setProperty("/Payload1/COSEmployee",t)},onDeleteCOSEmp:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/COSEmployee");n.splice(t,1);o.setProperty("/Payload1/COSEmployee",n)},onAddContractor:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/Contractor");t.push({});e.setProperty("/Payload1/Contractor",t)},onDeleteContarctor:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/Contractor");n.splice(t,1);o.setProperty("/Payload1/Contractor",n)},onAddMember:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/Member");t.push({});e.setProperty("/Payload1/Member",t)},onDeleteMember:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/Member");n.splice(t,1);o.setProperty("/Payload1/Member",n)},onSubmitInvestigation:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Payload1/IncNo");const d=a.getProperty("/Payload");const g=a.getProperty("/Payload/InvstStatus");const p=a.getProperty("/Payload4/wcbflag");if(d.ID!==undefined&&d.ID!==null&&d.ID!==""){if(g==="31"){t.warning("Investigation for incident "+c+" is already Completed.")}else{if(p!=="1"){t.warning("You cannot Complete Investigation before finalizing your review for WCB. Please finalize your Review to Complete Investigation.");a.refresh()}else{$.ajax({type:"PATCH",contentType:"application/json",url:l+"Investigation(ID="+d.ID+")",data:JSON.stringify({InvstStatus:"31"}),success:function(e,o){t.information("Investigation for incident "+c+" is Completed Succesfully");r.refresh()},error:function(){}});$.ajax({type:"PATCH",contentType:"application/json",url:l+"Incident(ID="+s+",INCID="+i+")",data:JSON.stringify({incStatus:"26"}),success:function(e,t){r.refresh()},error:function(){}})}}}else{t.warning("Investigation is not yet for "+c+" is not yet filled by Manager.")}},onDefaultDialogPress:function(){if(!this.__oMPDialog){const e=this.getView().getModel("localModel");e.setProperty("/child5",true);e.setProperty("/child6",false);this.__oMPDialog=sap.ui.xmlfragment("cosincidentportalhs.fragments.CorrectiveAction",this)}this.getView().addDependent(this.__oMPDialog);this.getView().getModel("localModel").setProperty("/CorrectAction",{});this.__oMPDialog.open()},onFragSubmit:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Payload1/IncNo");const d=a.getProperty("/CorrectAction");d.INCI_ID=s;d.INCI_INCID=i;const g=this;$.ajax({type:"POST",contentType:"application/json",url:l+"CorrectAction",data:JSON.stringify(d),success:function(e,o){t.information("Corrective Action created for Incident  "+c);r.refresh();g.onCancelFragment()},error:function(){}})},onDefaultDialogPressCA:function(e){const t=this.getView().getModel("localModel");const o=this.getView().getModel();const n=o.getServiceUrl();t.setProperty("/child5",false);t.setProperty("/child6",true);var s=e.getSource().getBindingContext().getObject().ID;if(!this.__oMPDialog){this.__oMPDialog=sap.ui.xmlfragment("cosincidentportalhs.fragments.CorrectiveAction",this)}this.getView().addDependent(this.__oMPDialog);this.getView().getModel("localModel").setProperty("/CorrectAction",{});this.__oMPDialog.open();$.ajax({type:"GET",contentType:"application/json",url:n+"CorrectAction"+"?$filter=ID eq "+s+"",success:function(e){console.log("Success:",e);t.setProperty("/CorrectAction",e.value[0])},error:function(){}})},onFragUpdate:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=n.INCID;const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/CorrectAction/ID");const d=a.getProperty("/CorrectAction");const g=a.getProperty("/Payload1/IncNo");const p=d.AssignTo;const y=this;$.ajax({type:"PUT",contentType:"application/json",url:l+"CorrectAction"+"(ID="+c+")",data:JSON.stringify(d),success:function(e,o){t.information("Corrective Action for Incident  "+g+"  Re-assignd to "+p+" Successfully.");y.onCancelFragment();r.refresh()},error:function(){}})},onCancelFragment:function(){this.__oMPDialog.close()},onDeleteCA:function(e){var o=e.getSource().getBindingContext().getObject().ID;const n=this.getView().getModel("localModel");const s=this.getView().getModel();const i=s.getServiceUrl();const a=n.getProperty("/CorrectAction");const r=n.getProperty("/Payload1/IncNo");sap.m.MessageBox.confirm("Are you sure you want delete Corrective Action for Incident "+r+" ?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"DELETE",contentType:"application/json",url:i+"CorrectAction"+"(ID="+o+")",data:JSON.stringify(a),success:function(e,o){t.information("Corrective Action Incident "+r+" deleted Successfully.");s.refresh()},error:function(){}})}}})},onNotesDialogPress:function(){const e=this.getView().getModel("localModel");const t=this.getView().getModel();const o=t.getServiceUrl();e.setProperty("/child5",true);e.setProperty("/child6",false);if(!this.oMPDialogNotes){this.oMPDialogNotes=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogNotes);this.getView().getModel("localModel").setProperty("/Notes",{NotesReview:-1});this.oMPDialogNotes.open()},OnSubmitNotes:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=this;const d=a.getProperty("/Notes");const g=a.getProperty("/Payload1/IncNo");d.INCI_ID=s;d.INCI_INCID=i;d.NotesReview=d.NotesReview===-1?"":d.NotesReview.toString();$.ajax({type:"POST",contentType:"application/json",url:l+"Notes",data:JSON.stringify(d),success:function(e,o){t.information("Notes Created for Incident "+g+" Succesfully.");r.refresh();c.OnCancelNotesFragment()},error:function(){}})},onEditNotes:function(e){var t=e.getSource().getBindingContext().getObject().ID;const o=this.getView().getModel("localModel");const n=this.getView().getModel();const s=n.getServiceUrl();o.setProperty("/child5",false);o.setProperty("/child6",true);if(!this.oMPDialogNotes){this.oMPDialogNotes=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogNotes);this.getView().getModel("localModel").setProperty("/Notes",{NotesReview:-1});this.oMPDialogNotes.open();$.ajax({type:"GET",contentType:"application/json",url:s+"Notes"+"?$filter=ID eq "+t+"",success:function(e){console.log("Success:",e);e.value[0].NotesReview=parseInt(e.value[0].NotesReview||-1);o.setProperty("/Notes",e.value[0])},error:function(){}})},OnUpdateNotes:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=n.INCID;const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Notes/ID");const d=a.getProperty("/Notes");const g=a.getProperty("/Payload1/IncNo");d.NotesReview=d.NotesReview===-1?"":d.NotesReview.toString();const p=this;$.ajax({type:"PUT",contentType:"application/json",url:l+"Notes"+"(ID="+c+")",data:JSON.stringify(d),success:function(e,o){t.information("Notes Updated for Incident "+g+" Succesfully.");r.refresh();p.OnCancelNotesFragment()},error:function(){}})},OnCancelNotesFragment:function(){this.oMPDialogNotes.close()},onDeleteNotes:function(e){var o=e.getSource().getBindingContext().getObject().ID;const n=this.getView().getModel("localModel");const s=this.getView().getModel();const i=s.getServiceUrl();const a=n.getProperty("/Notes");const r=n.getProperty("/Payload1/IncNo");sap.m.MessageBox.confirm("Are you sure you want delete Notes for Incident "+r+" ?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"DELETE",contentType:"application/json",url:i+"Notes"+"(ID="+o+")",data:JSON.stringify(a),success:function(e,o){t.information("Notes for Incident "+r+" deleted Succesfully  ");s.refresh()},error:function(){}})}}})},onPressValuHelp:function(e){const t=e.getParameters().selectedItem.getTitle();const o=e.getParameters().selectedItem.getDescription();this.getView().getModel("localModel").setProperty(this._inputPath,t)},handleValueHelp:function(e){var t=e.getSource().getValue(),o=this.getView();this._sInputId=e.getSource().getId();this._inputPath=e.getSource().getBindingInfo("value").parts[0].path;if(!this._pValueHelpDialog){this._pValueHelpDialog=s.load({id:o.getId(),name:"cosincidentportalhs.fragments.InvestigationBy",controller:this}).then(function(e){o.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.open()})},onFollowUpDialogPress:function(){if(!this.oMPDialogFollow){this.oMPDialogFollow=sap.ui.xmlfragment("cosincidentportalhs.fragments.FollowUp",this)}this.getView().addDependent(this.oMPDialogFollow);this.getView().getModel("localModel").setProperty("/FollowUp",{});this.oMPDialogFollow.open()},OnSubmitFollowUp:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=this;const d=a.getProperty("/FollowUp");d.INCI_ID=s;d.INCI_INCID=i;d.followupflg="1";$.ajax({type:"POST",contentType:"application/json",url:l+"Followup",data:JSON.stringify(d),success:function(e,o){t.information("FollowUp created with  "+e.ID);r.refresh();c.OnCancelFollowUpFragment()},error:function(){}})},OnUpdateFollowUp:function(e){var t=e.getSource().getBindingContext().getObject().ID;if(!this.oMPDialogFollow){this.oMPDialogFollow=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogFollow);this.getView().getModel("localModel").setProperty("/FollowUp",{});this.oMPDialogFollow.open();const o=this.getView().getModel("localModel");const n=this.getView().getModel();const s=n.getServiceUrl();$.ajax({type:"GET",contentType:"application/json",url:s+"FollowUp"+"?$filter=ID eq "+t+"",success:function(e){console.log("Success:",e);o.setProperty("/FollowUp",e.value[0])},error:function(){}})},OnCancelFollowUpFragment:function(){this.oMPDialogFollow.close()},OncompleteFollowUp:function(e){var o=this.getView().byId("FL1");var n=this.getView().byId("icontabbar1");var s=this.getView().byId("FL1").getSelectedItem();if(!s){sap.m.MessageBox.warning("Select an item");return}const i=this.getView().getModel("localModel");const a=this.getView().getModel();const r=a.getServiceUrl();const l=i.getProperty("/Payload1/IncNo");const c=i.getProperty("/FollowUp");if(c!==undefined&&c!==""&&c!==null){var d=s.getBindingContext().getObject();var g=this.getOwnerComponent().getModel("globalModel"),p=g.getProperty("/keys");const e=p.ID;const n=parseInt(p.INCID);const i=this.getView().getModel("localModel");const a=this.getView().getModel();const r=a.getServiceUrl();const l=i.getProperty("/Payload1/IncNo");const c=i.getProperty("/FollowUp");c.INCI_ID=e;c.INCI_INCID=n;if(d.followupstat==="28"){t.warning("Follow Up for Incident "+l+" is already Completed.")}else{sap.m.MessageBox.confirm("Are you sure you want to Mark follow up for "+l+" as 'Complete'?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"PATCH",contentType:"application/json",url:r+"Followup("+d.ID+")",data:JSON.stringify({followupflg:"1",followupstat:"28"}),success:function(e,n){t.success("Follow Up for Incident "+l+" is Completed Succesfully.");a.refresh();o.removeSelections()},error:function(){}})}}})}}else{t.success("Follow Up for Incident "+l+" is  .")}},onSubmitEHSRfrl:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/ReqAccom");const d=a.getProperty("/isaccomgttendays");const g=a.getProperty("/Other");const p=a.getProperty("/IssueHistory");const y=a.getProperty("/Payload2");y.ReqAccom=y.ReqAccom===-1?"":y.ReqAccom.toString();y.isaccomgttendays=y.isaccomgttendays===-1?"":y.isaccomgttendays.toString();y.reasonforref=y.reasonforref===-1?"":y.reasonforref.toString();y.INCI_INCID=i;y.INCI_ID=s;if(y.ID!==undefined&&y.ID!==null&&y.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:l+"EHSRef(ID="+y.ID+")",data:JSON.stringify(y),success:function(e,o){t.information("EHSRef Updated with  "+e.ID)},error:function(){}})}else{$.ajax({type:"POST",contentType:"application/json",url:l+"EHSRef",data:JSON.stringify(y),success:function(e,o){t.information("EHSRef created with  "+e.ID)},error:function(){}})}},onSubmitRTW:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/stdate");const d=a.getProperty("/Antienddate");const g=a.getProperty("/AccoPosDept");const p=a.getProperty("/date");const y=a.getProperty("/Payload3");y.INCI_INCID=i;y.INCI_ID=s;if(y.ID!==undefined&&y.ID!==null&&y.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:l+"RTW(ID="+y.ID+")",data:JSON.stringify(y),success:function(e,o){t.information("RTW Updated with  "+e.ID)},error:function(){}})}else{$.ajax({type:"POST",contentType:"application/json",url:l+"RTW",data:JSON.stringify(y),success:function(e,o){t.information("RTW created with  "+e.ID)},error:function(){}})}},onPressStartDate:function(){t.information("Note: Make sure the date you are mentioning here will be consider as your Return to work Date")},onPressDate:function(){t.information("Note: Make sure the date you are selecting is today's date and will be consider as your request finalizing date")},onPressAnticipatedDate:function(){t.information("Note: In case of any emergency if you unable to return to work on mentioned date, then what will be your extended return to work date? ")},onSubmitwcb:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=n.INCID;const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Payload4/injdate");const d=a.getProperty("/Payload4/WCBInjcat");const g=a.getProperty("/Payload4/WCBInjsubcat");const p=a.getProperty("/Payload4/InjDesc");const y=a.getProperty("/Payload4/Injstatus");const u=a.getProperty("/Payload4/Comments");const I=a.getProperty("/Payload4/Datereptosup");const P=a.getProperty("/Payload4/Datereptohr");const f=a.getProperty("/Payload4/Datereptowcb");const h=a.getProperty("/Payload4/firstdaylosttime");const C=a.getProperty("/Payload4/Datertw");const m=a.getProperty("/Payload4/claimstatus");const D=a.getProperty("/Payload4/whydenied");const w=a.getProperty("/Payload4/Claimno");const M=a.getProperty("/Payload4/letterrecwcb");const S=a.getProperty("/Payload4/Notimeloss");const v=a.getProperty("/Payload4/Notes");const N=a.getProperty("/Payload4/inj");const j={injdate:c,WCBInjcat:d,WCBInjsubcat:g,InjDesc:p,Injstatus:y,Comments:u,Datereptosup:I,Datereptohr:P,Datereptowcb:f,firstdaylosttime:h,Datertw:C,claimstatus:m,whydenied:D,Claimno:w,letterrecwcb:M,Notimeloss:S.toString(),INCI_INCID:parseInt(i),INCI_ID:s,Notes:v,inj:N};j.ID=a.getProperty("/Payload4/ID");if(j.ID!==undefined&&j.ID!==null&&j.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:l+"WCB(ID="+j.ID+")",data:JSON.stringify(j),success:function(e){t.success("WCB form "+e.ID+"  Submitted  Successfully.")}})}else{$.ajax({type:"POST",contentType:"application/json",url:l+"WCB",data:JSON.stringify(j),success:function(e){t.success("WCB form "+e.ID+"  Submitted  Successfully.")}})}},onAddInjury:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload4/inj");t.push({});e.setProperty("/Payload4/inj",t)},onDeleteInjury:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload4/inj");if(n.length>1){n.splice(t,1)}o.setProperty("/Payload4/inj",n)},onFinalReviewtwcb:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const s=n.ID;const i=parseInt(n.INCID);const a=this.getView().getModel("localModel");const r=this.getView().getModel();const l=r.getServiceUrl();const c=a.getProperty("/Payload4/wcbflag");const d=a.getProperty("/Payload4/ID");const g=a.getProperty("/Payload1/IncNo");if(c==="1"){t.warning("WCB form for  "+g+" is already reviewed.")}else{if(d!==undefined&&d!==null&&d!==""){$.ajax({type:"PATCH",contentType:"application/json",url:l+"WCB(ID="+d+")",data:JSON.stringify({wcbflag:"1"}),success:function(e,o){t.success("Review for WCB form for "+g+" is successfully completed.");r.refresh()},error:function(){}})}else{t.warning("WCB form for "+g+" is not yet filled by Manager.")}}},OnselectIconTab:function(e){var t=this.getOwnerComponent().getModel("globalModel"),o=t.getProperty("/keys");const n=o.ID;const s=parseInt(o.INCID);const i=this.getView().getModel("localModel");const a=this.getView().getModel();const r=a.getServiceUrl();var l=e.getParameter("item");var c=l.getKey();$.ajax({type:"GET",contentType:"application/json",url:r+"WCB"+"?$filter=INCI_ID eq %27"+n+"%27&$expand=inj",success:function(e){debugger;e.value[0].Notimeloss=parseInt(e.value[0].Notimeloss||-1);i.setProperty("/Payload4",e.value[0]===undefined?{inj:[]}:e.value[0])}})}})});
//# sourceMappingURL=IncidentPortalHS.controller.js.map
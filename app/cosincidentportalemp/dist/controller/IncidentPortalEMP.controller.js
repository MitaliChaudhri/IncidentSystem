sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Dialog"],function(e,t,o,n,a,s){"use strict";return e.extend("cosincidentportalemp.controller.IncidentPortalEMP",{onInit:function(){const e=new n({Notes:{addedby:"",addedon:"",IncNotes:"",NotesType:-1,NotesReview:-1,INCI_ID:"",INCI_INCID:""},Payload:{InvestigationBy:"",DateInvest:"",EmpRTW:-1,InvStatDetails:"",INCI_ID:"",INCI_INCID:""},CorrectAction:{AssignTo:"",DueDate:"",CAStatus:"",Comments:""},FollowUp:{followcrdate:"",followupcrby:"",folloupduedate:"",followupstat:"",followupcrfor:"",followupnotes:"",compdate:"",followupflg:""},Payload2:{ReqAccom:-1,isaccomgttendays:-1,reasonforref:-1,Other:"",IssueHistory:"",INCI_ID:"",INCI_INCID:""},Payload3:{stdate:"",Antienddate:"",Union:"",AccoPosDept:"",date:"",INCI_ID:"",INCI_INCID:""},Payload4:{WCB:{},inj:[{primaryinj:"",bodypart:"",side:""}]},IncidentCategorys:[{CatId:"1",Cattext:"Injury/Illness"},{CatId:"2",Cattext:"Property /Equipment Damage"},{CatId:"3",Cattext:"Near Miss"},{CatId:"4",Cattext:"Dangerous Occurrence"},{CatId:"5",Cattext:"Environment"},{CatId:"6",Cattext:"Security"}],IncidentTypes:[{TypeId:"1",IncText:"Non-Occupational"},{TypeId:"2",IncText:"No Treatment"},{TypeId:"3",IncText:"First Aid"},{TypeId:"4",IncText:"Medical Consultation"},{TypeId:"5",IncText:"Medical Aid"},{TypeId:"6",IncText:"Modified Work"},{TypeId:"7",IncText:"Lost time Incident"},{TypeId:"8",IncText:"Psychological"},{TypeId:"9",IncText:"Fatality"}],TypeofEvents:[{eventId:"1",eventtext:"Corporate"},{eventId:"2",eventtext:"Private"},{eventId:"3",eventtext:"Charity"}],IncSevirity:[{SevId:"1",Sevtext:"Critical"},{SevId:"2",Sevtext:"Major"},{SevId:"3",Sevtext:"Minor"}],WCBInjuryCategory:[{InjCatID:"1",InjCatText:"Acute Injury"},{InjCatID:"2",InjCatText:"Chronic Injury"}],WCBInjurySubCategory:[{InjSubCatID:"1",InjSubCatText:"Fractures"},{InjSubCatID:"2",InjSubCatText:"Sprains"},{InjSubCatID:"3",InjSubCatText:"Spinal Cord Injury"},{InjSubCatID:"4",InjSubCatText:"Dislocation"}],WCBInjuryStatus:[{InjStatID:"1",InjStatText:"Active"},{InjStatID:"2",InjStatText:"Healing"},{InjStatID:"3",InjStatText:"Recovered"},{InjStatID:"4",InjStatText:"Recurrent"}],WCBClaimStatus:[{ClaimStatID:"1",ClaimStatText:"Sbumitted"},{ClaimStatID:"2",ClaimStatText:"Under Review"},{ClaimStatID:"3",ClaimStatText:"Pending"},{ClaimStatID:"4",ClaimStatText:"Rejected"}],InjureSide:[{InjureSideID:"1",InjureSideText:"Upper"},{InjureSideID:"2",InjureSideText:"Lower"},{InjureSideID:"3",InjureSideText:"Right"},{InjureSideID:"4",InjureSideText:"Left"}],InjuryType:[{InjuryTypeID:"1",InjuryTypeText:"Primary"},{InjuryTypeID:"2",InjuryTypeText:"Secondary"}],EmpSupNames:[{name:"Stephan Lie",id:"1001"},{name:"Fay Van Damme",id:"1002"},{name:"Brevin Dice",id:"1003"},{name:"Regina Oleveria",id:"1004"},{name:"John Mathew",id:"1005"},{name:"Jim Parker",id:"1006"},{name:"Sophia Ran",id:"1007"},{name:"Wendi Blake",id:"1008"},{name:"Lois Lane",id:"1009"},{name:"Mary Magdalene",id:"1010"},{name:"Simon Cyrene",id:"1011"}],Payload1:{incident:{},wasIncOnCosloc:-1,noncosvehinvol:-1,isinvestreq:-1,shift:-1,wascosvehused:-1,isdraft:false,maxDate:new Date,COSEmployee:{},COSEquipment:[{EquipNo:""}],witness:[],addwellness:1,isCOSEmp:-1,COSEmployee:[],Contractor:[],Member:[],child1:false,child2:false,child3:false},ButtonVisibility:"1",child5:false,child6:false,child7:false});this.getView().setModel(e,"localModel");const t=new n(e.getData());this.getView().setModel(t,"oMasterData");var o=sap.ui.core.UIComponent.getRouterFor(this);o.getRoute("RouteIncidentPortalEMP").attachMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){const t=new n({Notes:{addedby:"",addedon:"",IncNotes:"",NotesType:-1,NotesReview:-1,INCI_ID:"",INCI_INCID:""},Payload:{InvestigationBy:"",DateInvest:"",EmpRTW:-1,InvStatDetails:"",INCI_ID:"",INCI_INCID:""},CorrectAction:{AssignTo:"",DueDate:"",CAStatus:"",Comments:""},FollowUp:{followcrdate:"",followupcrby:"",folloupduedate:"",followupstat:"",followupcrfor:"",followupnotes:"",compdate:"",followupflg:""},Payload2:{ReqAccom:-1,isaccomgttendays:-1,reasonforref:-1,Other:"",IssueHistory:"",INCI_ID:"",INCI_INCID:""},Payload3:{stdate:"",Antienddate:"",Union:"",AccoPosDept:"",date:"",INCI_ID:"",INCI_INCID:""},Payload4:{WCB:{},inj:[{primaryinj:"",bodypart:"",side:""}]},IncidentCategorys:[{CatId:"1",Cattext:"Injury/Illness"},{CatId:"2",Cattext:"Property /Equipment Damage"},{CatId:"3",Cattext:"Near Miss"},{CatId:"4",Cattext:"Dangerous Occurrence"},{CatId:"5",Cattext:"Environment"},{CatId:"6",Cattext:"Security"}],IncidentTypes:[{TypeId:"1",IncText:"Non-Occupational"},{TypeId:"2",IncText:"No Treatment"},{TypeId:"3",IncText:"First Aid"},{TypeId:"4",IncText:"Medical Consultation"},{TypeId:"5",IncText:"Medical Aid"},{TypeId:"6",IncText:"Modified Work"},{TypeId:"7",IncText:"Lost time Incident"},{TypeId:"8",IncText:"Psychological"},{TypeId:"9",IncText:"Fatality"}],TypeofEvents:[{eventId:"1",eventtext:"Corporate"},{eventId:"2",eventtext:"Private"},{eventId:"3",eventtext:"Charity"}],IncSevirity:[{SevId:"1",Sevtext:"Critical"},{SevId:"2",Sevtext:"Major"},{SevId:"3",Sevtext:"Minor"}],WCBInjuryCategory:[{InjCatID:"1",InjCatText:"Acute Injury"},{InjCatID:"2",InjCatText:"Chronic Injury"}],WCBInjurySubCategory:[{InjSubCatID:"1",InjSubCatText:"Fractures"},{InjSubCatID:"2",InjSubCatText:"Sprains"},{InjSubCatID:"3",InjSubCatText:"Spinal Cord Injury"},{InjSubCatID:"4",InjSubCatText:"Dislocation"}],WCBInjuryStatus:[{InjStatID:"1",InjStatText:"Active"},{InjStatID:"2",InjStatText:"Healing"},{InjStatID:"3",InjStatText:"Recovered"},{InjStatID:"4",InjStatText:"Recurrent"}],WCBClaimStatus:[{ClaimStatID:"1",ClaimStatText:"Sbumitted"},{ClaimStatID:"2",ClaimStatText:"Under Review"},{ClaimStatID:"3",ClaimStatText:"Pending"},{ClaimStatID:"4",ClaimStatText:"Rejected"}],InjureSide:[{InjureSideID:"1",InjureSideText:"Upper"},{InjureSideID:"2",InjureSideText:"Lower"},{InjureSideID:"3",InjureSideText:"Right"},{InjureSideID:"4",InjureSideText:"Left"}],InjuryType:[{InjuryTypeID:"1",InjuryTypeText:"Primary"},{InjuryTypeID:"2",InjuryTypeText:"Secondary"}],EmpSupNames:[{name:"Stephan Lie",id:"1001"},{name:"Fay Van Damme",id:"1002"},{name:"Brevin Dice",id:"1003"},{name:"Regina Oleveria",id:"1004"},{name:"John Mathew",id:"1005"},{name:"Jim Parker",id:"1006"},{name:"Sophia Ran",id:"1007"},{name:"Wendi Blake",id:"1008"},{name:"Lois Lane",id:"1009"},{name:"Mary Magdalene",id:"1010"},{name:"Simon Cyrene",id:"1011"}],Payload1:{incident:{},wasIncOnCosloc:-1,noncosvehinvol:-1,isinvestreq:-1,shift:-1,wascosvehused:-1,isdraft:false,maxDate:new Date,COSEmployee:{},COSEquipment:[{EquipNo:""}],witness:[],addwellness:1,isCOSEmp:-1,COSEmployee:[],Contractor:[],Member:[],child1:false,child2:false,child3:false},ButtonVisibility:"1",child5:false,child6:false,child7:false});this.getView().setModel(t,"localModel");var o=e.getParameters().arguments;var a=this.getOwnerComponent().getModel("globalModel"),s=o;a.setProperty("/keys",o);const i=o.ID;const r=o.INCID;var c=this.getOwnerComponent().getModel().getServiceUrl();var l=this.getView().byId("icontabbar1");l.setSelectedKey("icon1");const d=this.getView().getModel("localModel");const p=this.getView().getModel();const g=p.getServiceUrl();this.getView().byId("correctiveActionTable").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",i)]);this.getView().byId("NotesTable").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",i)]);this.getView().byId("FL1").getBinding("items").filter([new sap.ui.model.Filter("INCI_ID","EQ",i)]);$.ajax({url:c+"/Incident("+"ID="+s.ID+",INCID="+s.INCID+")",success:function(e){}}),$.ajax({type:"GET",contentType:"application/json",url:g+"Incident"+"(ID="+i+",INCID="+r+")?$expand=CosEquip,Witn,cos_emp,contract,public",success:function(e){console.log("Success:",e);e.wascosvehused=parseInt(e.wascosvehused);e.wasIncOnCosloc=parseInt(e.wasIncOnCosloc);e.noncosvehinvol=parseInt(e.noncosvehinvol);e.isinvestreq=parseInt(e.isinvestreq);e.yearexppos=parseInt(e.yearexppos);e.shift=parseInt(e.shift);e.COSEmployee=e.cos_emp;e.COSEquipment=e.CosEquip;e.witness=e.Witn;e.Contractor=e.contract;e.Member=e.public;e.addwellness=parseInt(e.addmentalhealth);if(e.otherpeopinv!==undefined&&e.otherpeopinv!==null&&e.otherpeopinv!==""){e.child1=e.otherpeopinv.split(",")[0]==="1"?true:false;e.child2=e.otherpeopinv.split(",")[1]==="1"?true:false;e.child3=e.otherpeopinv.split(",")[2]==="1"?true:false}d.setProperty("/Payload1",e)}}),$.ajax({type:"GET",contentType:"application/json",url:g+"Investigation"+"?$filter=INCI_ID eq %27"+i+"%27",success:function(e){console.log("Success:",e);e.value[0].EmpRTW=parseInt(e.value[0].EmpRTW||-1);d.setProperty("/Payload",e.value[0])},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:g+"EHSRef"+"?$filter=INCI_ID eq %27"+i+"%27",success:function(e){console.log("Success:",e);e.value[0].isaccomgttendays=parseInt(e.value[0].isaccomgttendays||-1);e.value[0].ReqAccom=parseInt(e.value[0].ReqAccom||-1);e.value[0].reasonforref=parseInt(e.value[0].reasonforref||-1);d.setProperty("/Payload2",e.value[0])},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:g+"RTW"+"?$filter=INCI_ID eq %27"+i+"%27",success:function(e){console.log("Success:",e);d.setProperty("/Payload3",e.value[0])},error:function(){}}),$.ajax({type:"GET",contentType:"application/json",url:g+"WCB"+"?$filter=INCI_ID eq %27"+i+"%27&$expand=inj",success:function(e){e.value[0].Notimeloss=parseInt(e.value[0].Notimeloss||-1);d.setProperty("/Payload4",e.value[0]===undefined?{inj:[]}:e.value[0])}})},onUpdateIncident:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=n.INCID;const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/Payload1/IncNo");const d=i.getProperty("/Payload1/Title");const p=i.getProperty("/Payload1/empname");const g=i.getProperty("/Payload1/empid");const I=i.getProperty("/Payload1/emppos");const y=i.getProperty("/Payload1/division");const u=i.getProperty("/Payload1/dept");const P=i.getProperty("/Payload1/section");const f=i.getProperty("/Payload1/incDate");const C=i.getProperty("/Payload1/inctime");const m=i.getProperty("/Payload1/incDaterep");const h=i.getProperty("/Payload1/inctimerep");const D=i.getProperty("/Payload1/supid");const S=i.getProperty("/Payload1/supname");const w=i.getProperty("/Payload1/yearexppos");const M=i.getProperty("/Payload1/wasIncOnCosloc");const v=i.getProperty("/Payload1/shift");const N=i.getProperty("/Payload1/latitude");const T=i.getProperty("/Payload1/longitude");const j=i.getProperty("/Payload1/wascosvehused");const x=i.getProperty("/Payload1/addwellness");const b=i.getProperty("/Payload1/busno");const O=i.getProperty("/Payload1/noncosvehinvol");const V=i.getProperty("/Payload1/policereportno");const E=i.getProperty("/Payload1/incCategory");const A=i.getProperty("/Payload1/incType");const _=i.getProperty("/Payload1/eventtype");const B=i.getProperty("/Payload1/actincseverity");const R=i.getProperty("/Payload1/potseverity");const U=i.getProperty("/Payload1/isinvestreq");let F=i.getProperty("/Payload1/child1")===true?"1":"0";F+=",";F+=i.getProperty("/Payload1/child2")===true?"1":"0";F+=",";F+=i.getProperty("/Payload1/child3")===true?"1":"0";const W=i.getProperty("/Payload1/incdesc");const q=i.getProperty("/Payload1/isdraft");const k=i.getProperty("/Payload1/COSEquipment");const J=i.getProperty("/Payload1/witness");const L=i.getProperty("/Payload1/COSEmployee");const H=i.getProperty("/Payload1/Contractor");const G=i.getProperty("/Payload1/Member");const K=new Date;var Q=new Date(K),z=""+(Q.getMonth()+1),Y=""+Q.getDate(),X=Q.getFullYear();if(z.length<2)z="0"+z;if(Y.length<2)Y="0"+Y;const Z={INCID:i.getProperty("/Payload1/INCID"),IncNo:l,Title:d,empname:p,empid:g,emppos:I,division:y,dept:u,section:P,incDate:f,inctime:C,incDaterep:m,inctimerep:h,supid:D,supname:S,yearexppos:parseInt(w,10)||0,wasIncOnCosloc:M.toString(),shift:v.toString(),latitude:N,longitude:T,wascosvehused:j.toString(),addmentalhealth:x.toString(),busno:b,noncosvehinvol:O.toString(),policereportno:V,incCategory:E,incType:A,eventtype:_,actincseverity:B,potseverity:R,isinvestreq:U.toString(),otherpeopinv:F,incdesc:W,isdraft:q,CosEquip:k.map(e=>{e.EquipNo=parseInt(e.EquipNo,10);return e}),Witn:J,cos_emp:L,contract:H,public:G};if(e.oSource.mProperties.text==="Submit"){Z.isdraft="0"}else{Z.isdraft="1"}Z.ID=i.getProperty("/Payload1/ID");$.ajax({type:"PUT",contentType:"application/json",url:c+"Incident(ID="+a+",INCID="+s+")",data:JSON.stringify(Z),success:function(e){t.success("Incident "+l+" Updated Successfully.")}})},onAddCOSEquip:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/COSEquipment");t.push({EquipNo:""});e.setProperty("/Payload1/COSEquipment",t)},onDeleteCOS:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/COSEquipment");if(n.length>1){n.splice(t,1)}o.setProperty("/Payload1/COSEquipment",n)},onAddWitness:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/witness");t.push({});e.setProperty("/Payload1/witness",t)},onDelete:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/witness");n.splice(t,1);o.setProperty("/Payload1/witness",n)},onAddCOSEmployee:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/COSEmployee");t.push({});e.setProperty("/Payload1/COSEmployee",t)},onDeleteCOSEmp:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/COSEmployee");n.splice(t,1);o.setProperty("/Payload1/COSEmployee",n)},onAddContractor:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/Contractor");t.push({});e.setProperty("/Payload1/Contractor",t)},onDeleteContarctor:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/Contractor");n.splice(t,1);o.setProperty("/Payload1/Contractor",n)},onAddMember:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload1/Member");t.push({});e.setProperty("/Payload1/Member",t)},onDeleteMember:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload1/Member");n.splice(t,1);o.setProperty("/Payload1/Member",n)},onSubmitInvestigation:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/DateInvest");const d=i.getProperty("/InvestigationBy");const p=i.getProperty("/EmpRTW");const g=i.getProperty("/InvStatDetails");const I=i.getProperty("/Payload1/IncNo");const y=this.getView().byId("radioGroup9");const u=y.getSelectedIndex();const P=y.getButtons()[u];const f=P.getText();const C=i.getProperty("/Payload");C.EmpRTW=C.EmpRTW.toString();C.INCI_INCID=s;C.INCI_ID=a;if(C.ID!==undefined&&C.ID!==null&&C.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:c+"Investigation(ID="+C.ID+")",data:JSON.stringify(C),success:function(e,o){t.information("Investigation for incident "+I+" Updated Succesfully");r.refresh()},error:function(){}})}else{$.ajax({type:"POST",contentType:"application/json",url:c+"Investigation",data:JSON.stringify(C),success:function(e,o){e.EmpRTW=parseInt(e.EmpRTW,10)||-1;i.setProperty("/Payload",e);t.information("Investigation created for Incident  "+I);r.refresh()},error:function(){}})}},onDefaultDialogPress:function(){if(!this.__oMPDialog){const e=this.getView().getModel("localModel");e.setProperty("/child5",true);e.setProperty("/child6",false);this.__oMPDialog=sap.ui.xmlfragment("cosincidentportalhs.fragments.CorrectiveAction",this)}this.getView().addDependent(this.__oMPDialog);this.getView().getModel("localModel").setProperty("/CorrectAction",{});this.__oMPDialog.open()},onFragSubmit:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/Payload1/IncNo");const d=i.getProperty("/CorrectAction");d.INCI_ID=a;d.INCI_INCID=s;const p=this;$.ajax({type:"POST",contentType:"application/json",url:c+"CorrectAction",data:JSON.stringify(d),success:function(e,o){t.information("Corrective Action created for Incident  "+l);r.refresh();p.onCancelFragment()},error:function(){}})},onDefaultDialogPressCA:function(e){const t=this.getView().getModel("localModel");const o=this.getView().getModel();const n=o.getServiceUrl();t.setProperty("/child5",false);t.setProperty("/child6",true);var a=e.getSource().getBindingContext().getObject().ID;if(!this.__oMPDialog){this.__oMPDialog=sap.ui.xmlfragment("cosincidentportalhs.fragments.CorrectiveAction",this)}this.getView().addDependent(this.__oMPDialog);this.getView().getModel("localModel").setProperty("/CorrectAction",{});this.__oMPDialog.open();$.ajax({type:"GET",contentType:"application/json",url:n+"CorrectAction"+"?$filter=ID eq "+a+"",success:function(e){console.log("Success:",e);t.setProperty("/CorrectAction",e.value[0])},error:function(){}})},onFragUpdate:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=n.INCID;const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/CorrectAction/ID");const d=i.getProperty("/CorrectAction");const p=i.getProperty("/Payload1/IncNo");const g=d.AssignTo;const I=this;$.ajax({type:"PUT",contentType:"application/json",url:c+"CorrectAction"+"(ID="+l+")",data:JSON.stringify(d),success:function(e,o){t.information("Corrective Action for Incident  "+p+"  Re-assignd to "+g+" Successfully.");I.onCancelFragment();r.refresh()},error:function(){}})},onCancelFragment:function(){this.__oMPDialog.close()},onDeleteCA:function(e){var o=e.getSource().getBindingContext().getObject().ID;const n=this.getView().getModel("localModel");const a=this.getView().getModel();const s=a.getServiceUrl();const i=n.getProperty("/CorrectAction");const r=n.getProperty("/Payload1/IncNo");sap.m.MessageBox.confirm("Are you sure you want delete Corrective Action for Incident "+r+" ?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"DELETE",contentType:"application/json",url:s+"CorrectAction"+"(ID="+o+")",data:JSON.stringify(i),success:function(e,o){t.information("Corrective Action Incident "+r+" deleted Successfully.");a.refresh()},error:function(){}})}}})},onNotesDialogPress:function(){const e=this.getView().getModel("localModel");const t=this.getView().getModel();const o=t.getServiceUrl();e.setProperty("/child5",true);e.setProperty("/child6",false);if(!this.oMPDialogNotes){this.oMPDialogNotes=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogNotes);this.getView().getModel("localModel").setProperty("/Notes",{NotesReview:-1});this.oMPDialogNotes.open()},OnSubmitNotes:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=this;const d=i.getProperty("/Notes");const p=i.getProperty("/Payload1/IncNo");d.INCI_ID=a;d.INCI_INCID=s;d.NotesReview=d.NotesReview===-1?"":d.NotesReview.toString();$.ajax({type:"POST",contentType:"application/json",url:c+"Notes",data:JSON.stringify(d),success:function(e,o){t.information("Notes Created for Incident "+p+" Succesfully.");r.refresh();l.OnCancelNotesFragment()},error:function(){}})},onEditNotes:function(e){var t=e.getSource().getBindingContext().getObject().ID;const o=this.getView().getModel("localModel");const n=this.getView().getModel();const a=n.getServiceUrl();o.setProperty("/child5",false);o.setProperty("/child6",true);if(!this.oMPDialogNotes){this.oMPDialogNotes=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogNotes);this.getView().getModel("localModel").setProperty("/Notes",{NotesReview:-1});this.oMPDialogNotes.open();$.ajax({type:"GET",contentType:"application/json",url:a+"Notes"+"?$filter=ID eq "+t+"",success:function(e){console.log("Success:",e);e.value[0].NotesReview=parseInt(e.value[0].NotesReview||-1);o.setProperty("/Notes",e.value[0])},error:function(){}})},OnUpdateNotes:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=n.INCID;const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/Notes/ID");const d=i.getProperty("/Notes");const p=i.getProperty("/Payload1/IncNo");d.NotesReview=d.NotesReview===-1?"":d.NotesReview.toString();const g=this;$.ajax({type:"PUT",contentType:"application/json",url:c+"Notes"+"(ID="+l+")",data:JSON.stringify(d),success:function(e,o){t.information("Notes Updated for Incident "+p+" Succesfully.");r.refresh();g.OnCancelNotesFragment()},error:function(){}})},OnCancelNotesFragment:function(){this.oMPDialogNotes.close()},onDeleteNotes:function(e){var o=e.getSource().getBindingContext().getObject().ID;const n=this.getView().getModel("localModel");const a=this.getView().getModel();const s=a.getServiceUrl();const i=n.getProperty("/Notes");const r=n.getProperty("/Payload1/IncNo");sap.m.MessageBox.confirm("Are you sure you want delete Notes for Incident "+r+" ?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"DELETE",contentType:"application/json",url:s+"Notes"+"(ID="+o+")",data:JSON.stringify(i),success:function(e,o){t.information("Notes for Incident "+r+" deleted Succesfully  ");a.refresh()},error:function(){}})}}})},onPressValuHelp:function(e){const t=e.getParameters().selectedItem.getTitle();const o=e.getParameters().selectedItem.getDescription();this.getView().getModel("localModel").setProperty(this._inputPath,t)},handleValueHelp:function(e){var t=e.getSource().getValue(),o=this.getView();this._sInputId=e.getSource().getId();this._inputPath=e.getSource().getBindingInfo("value").parts[0].path;if(!this._pValueHelpDialog){this._pValueHelpDialog=a.load({id:o.getId(),name:"cosincidentportalhs.fragments.InvestigationBy",controller:this}).then(function(e){o.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.open()})},onFollowUpDialogPress:function(){if(!this.oMPDialogFollow){this.oMPDialogFollow=sap.ui.xmlfragment("cosincidentportalhs.fragments.FollowUp",this)}this.getView().addDependent(this.oMPDialogFollow);this.getView().getModel("localModel").setProperty("/FollowUp",{});this.oMPDialogFollow.open()},OnSubmitFollowUp:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=this;const d=i.getProperty("/FollowUp");d.INCI_ID=a;d.INCI_INCID=s;d.followupflg="1";$.ajax({type:"POST",contentType:"application/json",url:c+"Followup",data:JSON.stringify(d),success:function(e,o){t.information("FollowUp created with  "+e.ID);r.refresh();l.OnCancelFollowUpFragment()},error:function(){}})},OnUpdateFollowUp:function(e){var t=e.getSource().getBindingContext().getObject().ID;if(!this.oMPDialogFollow){this.oMPDialogFollow=sap.ui.xmlfragment("cosincidentportalhs.fragments.Notes",this)}this.getView().addDependent(this.oMPDialogFollow);this.getView().getModel("localModel").setProperty("/FollowUp",{});this.oMPDialogFollow.open();const o=this.getView().getModel("localModel");const n=this.getView().getModel();const a=n.getServiceUrl();$.ajax({type:"GET",contentType:"application/json",url:a+"FollowUp"+"?$filter=ID eq "+t+"",success:function(e){console.log("Success:",e);o.setProperty("/FollowUp",e.value[0])},error:function(){}})},OnCancelFollowUpFragment:function(){this.oMPDialogFollow.close()},OncompleteFollowUp:function(e){var o=this.getView().byId("FL1");var n=this.getView().byId("icontabbar1");var a=this.getView().byId("FL1").getSelectedItem();if(!a){sap.m.MessageBox.warning("Select an item");return}var s=a.getBindingContext().getObject();var i=this.getOwnerComponent().getModel("globalModel"),r=i.getProperty("/keys");const c=r.ID;const l=parseInt(r.INCID);const d=this.getView().getModel("localModel");const p=this.getView().getModel();const g=p.getServiceUrl();const I=d.getProperty("/Payload1/IncNo");const y=d.getProperty("/FollowUp");y.INCI_ID=c;y.INCI_INCID=l;if(s.followupstat==="28"){t.warning("Follow Up for Incident "+I+" is already Completed.")}else{sap.m.MessageBox.confirm("Are you sure you want to Mark follow up for "+I+" as 'Complete'?",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){$.ajax({type:"PATCH",contentType:"application/json",url:g+"Followup("+s.ID+")",data:JSON.stringify({followupflg:"1",followupstat:"28"}),success:function(e,n){t.success("Follow Up for Incident "+I+" is Completed Succesfully.");p.refresh();o.removeSelections()},error:function(){}})}}})}},onSubmitEHSRfrl:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/ReqAccom");const d=i.getProperty("/isaccomgttendays");const p=i.getProperty("/Other");const g=i.getProperty("/IssueHistory");const I=i.getProperty("/Payload2");I.ReqAccom=I.ReqAccom===-1?"":I.ReqAccom.toString();I.isaccomgttendays=I.isaccomgttendays===-1?"":I.isaccomgttendays.toString();I.reasonforref=I.reasonforref===-1?"":I.reasonforref.toString();I.INCI_INCID=s;I.INCI_ID=a;if(I.ID!==undefined&&I.ID!==null&&I.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:c+"EHSRef(ID="+I.ID+")",data:JSON.stringify(I),success:function(e,o){t.information("EHSRef Updated with  "+e.ID)},error:function(){}})}else{$.ajax({type:"POST",contentType:"application/json",url:c+"EHSRef",data:JSON.stringify(I),success:function(e,o){t.information("EHSRef created with  "+e.ID)},error:function(){}})}},onSubmitRTW:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/stdate");const d=i.getProperty("/Antienddate");const p=i.getProperty("/AccoPosDept");const g=i.getProperty("/date");const I=i.getProperty("/Payload3");I.INCI_INCID=s;I.INCI_ID=a;if(I.ID!==undefined&&I.ID!==null&&I.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:c+"RTW(ID="+I.ID+")",data:JSON.stringify(I),success:function(e,o){t.information("RTW Updated with  "+e.ID)},error:function(){}})}else{$.ajax({type:"POST",contentType:"application/json",url:c+"RTW",data:JSON.stringify(I),success:function(e,o){t.information("RTW created with  "+e.ID)},error:function(){}})}},onPressStartDate:function(){t.information("Note: Make sure the date you are mentioning here will be consider as your Return to work Date")},onPressDate:function(){t.information("Note: Make sure the date you are selecting is today's date and will be consider as your request finalizing date")},onPressAnticipatedDate:function(){t.information("Note: In case of any emergency if you unable to return to work on mentioned date, then what will be your extended return to work date? ")},onSubmitwcb:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=n.INCID;const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/Payload4/injdate");const d=i.getProperty("/Payload4/WCBInjcat");const p=i.getProperty("/Payload4/WCBInjsubcat");const g=i.getProperty("/Payload4/InjDesc");const I=i.getProperty("/Payload4/Injstatus");const y=i.getProperty("/Payload4/Comments");const u=i.getProperty("/Payload4/Datereptosup");const P=i.getProperty("/Payload4/Datereptohr");const f=i.getProperty("/Payload4/Datereptowcb");const C=i.getProperty("/Payload4/firstdaylosttime");const m=i.getProperty("/Payload4/Datertw");const h=i.getProperty("/Payload4/claimstatus");const D=i.getProperty("/Payload4/whydenied");const S=i.getProperty("/Payload4/Claimno");const w=i.getProperty("/Payload4/letterrecwcb");const M=i.getProperty("/Payload4/Notimeloss");const v=i.getProperty("/Payload4/Notes");const N=i.getProperty("/Payload4/inj");const T={injdate:l,WCBInjcat:d,WCBInjsubcat:p,InjDesc:g,Injstatus:I,Comments:y,Datereptosup:u,Datereptohr:P,Datereptowcb:f,firstdaylosttime:C,Datertw:m,claimstatus:h,whydenied:D,Claimno:S,letterrecwcb:w,Notimeloss:M.toString(),INCI_INCID:parseInt(s),INCI_ID:a,Notes:v,inj:N};T.ID=i.getProperty("/Payload4/ID");if(T.ID!==undefined&&T.ID!==null&&T.ID!==""){$.ajax({type:"PUT",contentType:"application/json",url:c+"WCB(ID="+T.ID+")",data:JSON.stringify(T),success:function(e){t.success("WCB form "+e.ID+"  Submitted  Successfully.")}})}else{$.ajax({type:"POST",contentType:"application/json",url:c+"WCB",data:JSON.stringify(T),success:function(e){t.success("WCB form "+e.ID+"  Submitted  Successfully.")}})}},onAddInjury:function(){const e=this.getView().getModel("localModel");const t=e.getProperty("/Payload4/inj");t.push({});e.setProperty("/Payload4/inj",t)},onDeleteInjury:function(e){const t=e.getSource().getBindingContext("localModel").getPath().slice(-1);const o=this.getView().getModel("localModel");const n=o.getProperty("/Payload4/inj");if(n.length>1){n.splice(t,1)}o.setProperty("/Payload4/inj",n)},onFinalReviewtwcb:function(e){var o=this.getOwnerComponent().getModel("globalModel"),n=o.getProperty("/keys");const a=n.ID;const s=parseInt(n.INCID);const i=this.getView().getModel("localModel");const r=this.getView().getModel();const c=r.getServiceUrl();const l=i.getProperty("/Payload4/wcbflag");const d=i.getProperty("/Payload4/ID");const p=i.getProperty("/Payload1/IncNo");if(l==="1"){t.warning("WCB form for  "+p+" is already reviewed.")}else{if(d!==undefined&&d!==null&&d!==""){$.ajax({type:"PATCH",contentType:"application/json",url:c+"WCB(ID="+d+")",data:JSON.stringify({wcbflag:"1"}),success:function(e,o){t.success("Review for WCB form for "+p+" is successfully completed.");r.refresh()},error:function(){}})}else{t.warning("WCB form for "+p+" is not yet filled by Manager.")}}}})});
//# sourceMappingURL=IncidentPortalEMP.controller.js.map